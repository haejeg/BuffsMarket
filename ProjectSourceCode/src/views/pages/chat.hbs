<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Messages</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #363636;
      color: white;
    }
    a, a:hover {
      color: white;
      text-decoration: none;
    }
    .form-label, .btn, #loadingMessage, #errorMessage, .text-muted {
      color: white;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="py-3 mb-4" style="background-color: color: #363636;">
    <div class="container">
      <h1 class="text-center text-white">Messages</h1>
    </div>
  </header>

  <main class="container">
    <!-- Message Sending Form -->
    <section class="mb-5">
      <h2 class="mb-3 text-white">Send a Message</h2>
      <form action="/chat" method="POST" class="row g-3">
        <div class="col-md-6">
          <label for="receiverID" class="form-label">Receiver ID:</label>
          <input 
            type="text" 
            id="receiverID" 
            name="receiverID" 
            class="form-control" 
            required 
            maxlength="10" 
            pattern="\d+" 
            placeholder="Enter receiver ID">
        </div>
        <div class="col-12">
          <label for="content" class="form-label">Message:</label>
          <textarea 
            id="content" 
            name="content" 
            class="form-control" 
            rows="4" 
            required 
            maxlength="500" 
            placeholder="Type your message here"></textarea>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary">Send</button>
        </div>
      </form>
      <p id="loadingMessage" class="mt-3"></p>
      <p id="errorMessage" class="mt-3"></p>
    </section>

    <!-- Received Messages -->
    <section>
      <h2 class="mb-3 text-white">Your Messages</h2>
      <ul id="messagesList" class="list-group">
        <!-- Messages will be dynamically populated here -->
      </ul>
    </section>
  </main>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // The original messaging logic remains unchanged
    async function fetchMessages() {
      const loadingMessage = document.getElementById('loadingMessage');
      try {
        loadingMessage.textContent = 'Loading messages...';

        const response = await fetch('/messages');
        if (!response.ok) {
          throw new Error('Failed to fetch messages');
        }
        const messages = await response.json();
        console.log(messages); // Debugging purposes, lets maybe remove this later. Checkpoint 1.

        // Hide the loading message
        loadingMessage.textContent = '';

        // Clear the existing messages
        const messagesList = document.getElementById('messagesList');
        messagesList.innerHTML = '';

        // Render the fetched messages
        if (messages.length === 0) {
          messagesList.innerHTML = '<p class="text-white">No messages yet.</p>';
        } else {
          messages.forEach((message) => {
            const listItem = document.createElement('li');
            console.log(message.sendernickname) //Another debugging checkpoint
            listItem.className = 'list-group-item bg-dark text-white';
            listItem.innerHTML = `
              <strong>${message.sendernickname}</strong> <small class="text-muted">(${message.timestamp})</small>:
              <p class="mb-0">${message.content}</p>
            `;
            messagesList.appendChild(listItem);
            console.log(listItem) //Checkpoint #3, although this should be straight output
          });
        }
      } catch (error) {
        console.error('Error fetching messages:', error);
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.textContent = 'Error fetching messages. Please try again.';
      }
    }

    // Call fetchMessages on page load
    document.addEventListener('DOMContentLoaded', fetchMessages);
  </script>
</body>
</html>
